# GoRazor

GoRazor is the Go port of the razor view engine originated from [asp.net in 2011](http://weblogs.asp.net/scottgu/archive/2010/07/02/introducing-razor.aspx). In summary, GoRazor's:

* Concise syntax, no delimiter like `<?`, `<%`, or `{{`.
  * Original [Razor Syntax](http://www.asp.net/web-pages/tutorials/basics/2-introduction-to-asp-net-web-programming-using-the-razor-syntax) & [quick reference](http://haacked.com/archive/2011/01/06/razor-syntax-quick-reference.aspx/) for asp.net.
* Able to mix go code in view template
  * Insert code block to import & call arbitrary go modules & functions
  * Flow controls are just Go, no need to learn another mini-language
* Code generation approach
  * No reflection overhead
  * Go compiler validation for free
* Strong type view model
* Embedding templates support
* Layout/Section support

# Usage

Install:

```sh
go get github.com/mgutz/gorazor
```

Usage:

`gorazor template_folder output_folder` or
`gorazor template_file output_file`

# Syntax

## Variable

* `@variable` to insert **string** variable into html template
* variable could be wrapped by arbitrary go functions
* variable inserted will be automatically [escaped](http://golang.org/pkg/html/template/#HTMLEscapeString)

```html
<div>Hello @user.Name</div>
```

```html
<div>Hello @strings.ToUpper(req.CurrentUser.Name)</div>
```

`gorazor` by defaults escapes any value that is not a `SafeBuffer`. To
insert unescaped data create a helper function. See [example helper](views/helper.go) directory:

```go
func Raw(t interface{}) gorazor.SafeBuffer {
	// Safe = true tells `gorazor` this buffer is safe to write as-is
	buffer := gorazor.NewSafeBuffer()
	buffer.WriteString(fmt.Sprint(t))
	return buffer
}
```


## Flow Control

```php
@if .... {
	....
}

@if .... {
	....
} else {
	....
}

@for .... {

}

@{
	switch .... {
	case ....:
	      <p>...</p>
	case 2:
	      <p>...</p>
	default:
	      <p>...</p>
	}
}
```

## Code block

It's possible to insert arbitrary go code block in the template, like create new variable.

```html
@{
	username := u.Name
	if u.Email != "" {
		username += "(" + u.Email + ")"
	}
}
<div class="welcome">
<h4>Hello @username</h4>
</div>
```

It's recommendation to keep clean separation of code & view. Please consider move logic into your code before creating a code block in template.

## Declaration

The **first code block** in template is strictly for declaration:

* imports
* model type
* layout

like:

```go
@{
	import  (
		"kp/models"   //import `"kp/models"` package
		"tpl/layout/base"  //Use tpl/layout package's **base func** for layout
	)
	var user *models.User //1st template param
	var blog *models.Blog //2nd template param
}
...
```

**first code block** must be at the beginning of the template, i.e. before any html.

Any other codes inside the first code block will **be ignored**.

import must be wrapped in `()`, `import "package_name"` is not yet supported.

The variables declared in **first code block** will be the models of the template, i.e. the parameters of generated function.

If your template doesn't need any model input, then just leave it blank.

## Helper / Include other template

As gorazor compiles templates to go function, embedding another template is just calling the generated function, like any other go function.

However, if the template are designed to be embedded, it must be under `helper` namespace, i.e. put them in `helper` sub-folder.

So, using a helper template is similar to:

```html

@if msg != "" {
	<div>@helper.ShowMsg(msg)</div>
}

```

## Layout & Section

The syntax for declaring layout is a bit tricky, in the example mentioned above:

```go
@{
	import  (
		"tpl/layout/base"
	)
}
```

`"tpl/layout/base"` **is not** a package, it's actually referring to `"tpl/layout"` package's **Base** function, which should be generated by `tpl/layout/base.gohtml`.

GoRazor is using the second last part of namespace `layout` as a magic string to decide if the import is for layout declaration or normal import.

A layout file `tpl/layout/base.gohtml` may look like:

```html
@{
	var body gorazor.SafeBuffer
	var sidebar gorazor.SafeBuffer
	var footer gorazor.SafeBuffer
	var title gorazor.SafeBuffer
	var css gorazor.SafeBuffer
	var js gorazor.SafeBuffer
}

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>@title</title>
</head>
<body>
        <div class="container">@body</div>
        <div class="sidebar">@sidebar</div>
        <div class="footer">@footer</div>
        @js
</body>
</html>
```

It's just a usual gorazor template, but:

* First param must be `var body gorazor.SafeBuffer` (As it's always required, maybe we could remove it in future?)
* All params **must be** `gorazor.SafeBuffer`, each param is considered as a **section**, the variable name is the **section name**.
* Under `layout` package, i.e. within "layout" folder.

A template using such layout `tpl/index.gohtml` may look like:

```html
@{
	import (
		"tpl/layout"
	)
}

@section footer {
	<div>Copyright 2014</div>
}

<h2>Welcome to homepage</h2>
```

With the page, the page content will be treated as the `body` section in layout.

The other section content need to be wrapped with
```
@section SectionName {
	....
}
```

The template doesn't need to specify all section defined in layout. If a section is not specified, it will be consider as `""`.

Thus, it's possible for the layout to define default section content in such manner:

```html
@{
	var body gorazor.SafeBuffer
	var sidebar gorazor.SafeBuffer
}

<body>
    <div class="container">@body</div>
    @if sidebar == "" {
    <div class="sidebar">I'm the default side bar</div>
	} else {
    <div class="sidebar">@sidebar</div>
	}
</body>
```

* A layout should be able to use another layout, it's just function call.

# Conventions

* Template **folder name** will be used as **package name** in generated code
* Template file name must has the extension name `.gohtml`
* Template strip of `.gohtml` extension name will be used as the **function name** in generated code, with **first letter Capitalized**.
  * So that the function will be accessible to other modules. (I hate GO about this.)
* Layout templates **must** has the package name **layout**, i.e. in `layout` folder.

# Example

See the example [gorazor templates](https://github.com/mgutz/gorazor/tree/master/example).

# FAQ

## How to auto re-generate when gohtml file changes?

Use the right tool for the job. I recommend [node.js](https://nodejs.org) and
[gulp](https://gulpjs.com). As of now build and asset preprocessing is lacking
for gophers.

See `example` directory for an example `gulpfile`

# Credits

The very [first version](https://github.com/sipin/gorazor/releases/tag/vash) of GoRazor is essentially a hack of razor's port in javascript: [vash](https://github.com/kirbysayshi/vash), thus requires node's to run.

GoRazor has been though several rounds of refactoring and it has completely rewritten in pure Go. Nonetheless, THANK YOU [@kirbysayshi](https://github.com/kirbysayshi) for Vash! Without Vash, GoRazor may never start.

# Todo

* Add tools, like monitor template changes and auto re-generate
* Add default html widgets
* Add more usage examples
* Generate more function overloads, like accept additional buffer parameter for write
